################################################################################
################################################################################
# SET UP
# REMOVE OBJECTS
rm(list=ls())
# LOAD LIBRARIES
library(dlnm) ; library(splines) ; library(tsModel); library(mgcv) ;library(foreign)
# LOAD FRANCESCO DATA
ind <- "~/Dropbox/MCC_Aurelio/September_2020"
load(paste(ind,"MCCdata_20200907.RData",sep="/"))
# SELECT DATA
subcountry <- sort(c("arg0515",
"aus8809",
"bra9711",
"can8615",
"chl0414",
"chi9615",
"col9813",
"crc0017",
"cze9415",
"ecu1418",
"est9715",
"fnl9414",
"fra0014",
"ger9315",
"grc0110",
"gua0916",
"irn0215",
"irl8407",
"ita0615",
"jap7215",
"kuw0016",
"mex9814",
"mld0110",
"net9516c",
"nor6918",
"pan1316",
"par0416",
"per0814",
"phi0610",
"por8018",
"pue0916",
"rom9416",
"sa9713",
"kor9718",
"spa9014",
"swe9016",
"sui9513",
"twn9414",
"tha9908",
"uk9016",
"uru1216",
"usa7306",
"vie0913"))
dlist <- dlist[cities$country%in%subcountry]
cities <- cities[cities$country%in%subcountry,]
countries <- countries[countries$country%in%subcountry,]
################################################################################
# EXCLUDE CITIES, PERIODS AND OUTLIERS
# EXCLUDE TANGSHAN IN CHINA, WITH WEIRD DEATH COUNTS DISTRIBUTION
dlist[cities$city=="tngs.chi9615"] <- NULL
cities <- cities[-which(cities$city=="tngs.chi9615"),]
# EXCLUDE NANJING IN CHINA, WITH NO COUNTS FOR ALL/NONEXTERNAL MORTALITY
dlist[cities$city=="nnjn.chi9615"] <- NULL
cities <- cities[-which(cities$city=="nnjn.chi9615"),]
# EXCLUDE EARLIER YEARS FOR JAPAN
for(i in which(cities$country%in%"jap7215"))
dlist[[i]] <- dlist[[i]][dlist[[i]]$year>=1985,]
# EXCLUDE EARLIER YEARS FOR NORWAY
for(i in which(cities$country%in%"nor6916"))
dlist[[i]] <- dlist[[i]][dlist[[i]]$year>=1985,]
# SET OUTLIERS TO MISSING
for(i in seq(nrow(cities))) {
if(is.null(dlist[[i]]$all)) dlist[[i]]$nonext[dlist[[i]]$outlierm==1] <- NA else
dlist[[i]]$all[dlist[[i]]$outlierm==1] <- NA
dlist[[i]]$tmean[dlist[[i]]$outliert==1] <- NA
}
rownames(cities) <- seq(nrow(cities))
cities[1:4] <- as.data.frame(as.matrix(cities[1:4]))
rownames(countries) <- seq(nrow(countries))
library(tidyverse)
id_city <- filter(cities, countryname == "Spain") %>% pull(city)
subset_spain <- dlist[id_city]
subset_spain
id_city
names(subset_spain)
View(countries)
View(countries)
# LOAD FRANCESCO DATA
ind <- "~/Dropbox/MCC_Aurelio/September_2020"
load(paste(ind,"MCCdata_20200907.RData",sep="/"))
library(tidyverse)
id_city <- filter(cities, countryname == "Spain") %>% pull(city)
subset_spain <- dlist[id_city]
names(subset_spain)
install.packages("hysplit", lib="/Library/Frameworks/R.framework/Versions/3.6/Resources/library")
install.packages("splitr", lib="/Library/Frameworks/R.framework/Versions/3.6/Resources/library")
?forest
library(meta)
?forest
library(tsModel);
?tsmodel
??tsmodel
data(balt
)
data(balt)
data<-data(balt)
data
library(tsModel)
data(balt)
balt
library(dlnm)
chicagoNMMAPS
data<-read.dta("valencia_wide.dta")
library(foreign)
data<-read.dta("valencia_wide.dta")
# Load libraries
library(foreign)
library(tidyverse)
# Load libraries
library(foreign)
library(tidyverse)
library(splines)
library(gnm)
# time-series analysis
spl <- ns(data$date, df=49)
model.ts0 <- glm(tm ~ spl, data=data, family=quasipoisson)
pred.ts0 <- predict(model.ts0, type="response")
##########################################################
### Modelización de regresión de series temporales con R.
### XIV Summer School MESIO UPC-UB
### Práctica Sesión 5: Case-crossover
### Aurelio Tobias
##########################################################
# Load libraries
library(foreign)
library(tidyverse)
library(splines)
library(gnm)
### Example 1. time-series vs time-stratified case-crossover
############################################################
# load data set from Valencia (Esp) 2000-2006
data <- read.dta("misdatos_valencia.dta")
str(data)
data$tm <- data$tm0 + data$tm1
# time-series analysis
spl <- ns(data$date, df=49)
model.ts0 <- glm(tm ~ spl, data=data, family=quasipoisson)
pred.ts0 <- predict(model.ts0, type="response")
##########################################################
### Modelización de regresión de series temporales con R.
### XIV Summer School MESIO UPC-UB
### Práctica Sesión 5: Case-crossover
### Aurelio Tobias
##########################################################
# Load libraries
library(foreign)
library(tidyverse)
library(splines)
library(gnm)
### Example 1. time-series vs time-stratified case-crossover
############################################################
# load data set from Valencia (Esp) 2000-2006
data <- read.dta("misdatos_valencia.dta")
str(data)
data$tm <- data$tm0 + data$tm1
# time-series analysis
spl <- ns(data$date, df=49)
model.ts0 <- glm(tm ~ spl, data=data, family=quasipoisson)
pred.ts0 <- predict(model.ts0, type="response")
##########################################################
### Modelización de regresión de series temporales con R.
### XIV Summer School MESIO UPC-UB
### Práctica Sesión 5: Case-crossover
### Aurelio Tobias
##########################################################
# Load libraries
library(foreign)
library(tidyverse)
library(splines)
library(gnm)
### Example 1. time-series vs time-stratified case-crossover
############################################################
# load data set from Valencia (Esp) 2000-2006
data <- read.dta("misdatos_valencia.dta")
str(data)
data$tm <- data$tm0 + data$tm1
# time-series analysis
spl <- ns(data$date, df=49)
setwd("~/Dropbox/UPCXIVSC_RST/5 Viernes/Datos")
##########################################################
### Modelización de regresión de series temporales con R.
### XIV Summer School MESIO UPC-UB
### Práctica Sesión 5: Case-crossover
### Aurelio Tobias
##########################################################
# Load libraries
library(foreign)
library(tidyverse)
library(splines)
library(gnm)
### Example 1. time-series vs time-stratified case-crossover
############################################################
# load data set from Valencia (Esp) 2000-2006
data <- read.dta("misdatos_valencia.dta")
str(data)
data$tm <- data$tm0 + data$tm1
# time-series analysis
spl <- ns(data$date, df=49)
model.ts0 <- glm(tm ~ spl, data=data, family=quasipoisson)
pred.ts0 <- predict(model.ts0, type="response")
# time-stratified case-crossover
data$month    <- as.factor(months(data$date))
data$year     <- as.factor(format(data$date, format="%Y") )
data$dow      <- as.factor(weekdays(data$date))
data$stratum2 <- as.factor(data$year:data$month)
model.cc0 <- glm(tm ~ stratum2, data=data, family=quasipoisson)
pred.cc0 <- predict(model.cc0, type="response")
# comparison
plot(data$date, data$tm, pch=19, cex=0.2, col=grey(0.6), ylab="Num. deaths", xlab="Date")
lines(data$date, pred.cc0, lwd=2, col="blue")
lines(data$date, pred.ts0, lwd=2, col="red")
# time-series
model.ts1 <- glm(tm ~ tsp + spl + dow + hol, data=data, family=quasipoisson)
cbind(model.ts1$coefficients[2], sqrt(summary(model.ts1)$cov.scaled[2,2]))
# case-crossover with Poisson regression fitting 3-way interaction
start1 <- Sys.time()
model.cco1 <- glm(tm ~ tsp + hol + factor(year)*factor(month)*factor(dow), data=data, family=quasipoisson)
end1 <- Sys.time()
summary(model.cco1)
data$stratum3 <- as.factor(data$year:data$month:data$dow)
start2 <- Sys.time()
model.cco2 <- glm(tm ~ tsp + hol + stratum3 , data=data, family=quasipoisson)
end2 <- Sys.time()
summary(model.cco2)
# case-crossover with conditional Poisson
start3 <- Sys.time()
model.cco3 <- gnm(tm ~ tsp + hol , data=data, family=quasipoisson, eliminate=factor(stratum3))
end3 <- Sys.time()
summary(model.cco3)
# comparison within case-crossover approaches
cbind(model.cco1$coefficients[2], sqrt(summary(model.cco1)$cov.scaled[2,2]), end1-start1)
cbind(model.cco2$coefficients[2], sqrt(summary(model.cco2)$cov.scaled[2,2]), end2-start2)
cbind(model.cco3$coefficients[1], sqrt(summary(model.cco3)$cov.scaled[1,1]), end3-start3)
# overall comparison between time-series vs case-crossover
# time-series
cbind((exp(model.ts1$coefficients[2]*10)-1)*100,
(exp((model.ts1$coefficients[2]-1.96*sqrt(summary(model.ts1)$cov.scaled[2,2]))*10)-1)*100,
(exp((model.ts1$coefficients[2]+1.96*sqrt(summary(model.ts1)$cov.scaled[2,2]))*10)-1)*100)
# case-crossover
cbind((exp(model.cco3$coefficients[1]*10)-1)*100,
(exp((model.cco3$coefficients[1]-1.96*sqrt(summary(model.cco3)$cov.scaled[1,1]))*10)-1)*100,
(exp((model.cco3$coefficients[1]+1.96*sqrt(summary(model.cco3)$cov.scaled[1,1]))*10)-1)*100)
# regresión de series temporales
spl <- ns(data$date, df=42)
model.ts0 <- glm(tm ~ spl, data=data, family=quasipoisson)
pred.ts0 <- predict(model.ts0, type="response")
# case-crossover por mes-año
data$month    <- as.factor(months(data$date))
data$year     <- as.factor(format(data$date, format="%Y") )
data$dow      <- as.factor(weekdays(data$date))
data$stratum2 <- as.factor(data$year:data$month)
model.cc0 <- glm(tm ~ stratum2, data=data, family=quasipoisson)
pred.cc0 <- predict(model.cc0, type="response")
plot(data$date, data$tm, pch=19, cex=0.2, col=grey(0.6), ylab="Num. deaths", xlab="Date")
lines(data$date, pred.cc0, lwd=2, col="blue")
lines(data$date, pred.ts0, lwd=2, col="red")
model.ts1 <- glm(tm ~ tsp + spl + dow + hol, data=data, family=quasipoisson)
cbind(model.ts1$coefficients[2], sqrt(summary(model.ts1)$cov.scaled[2,2]))
# Load libraries
library(foreign)
library(tidyverse)
library(splines)
library(gnm)
# load data set from Valencia (Esp) 2000-2006
data <- read.dta("misdatos_valencia.dta")
str(data)
data$tm <- data$tm0 + data$tm1
# time-series analysis
spl <- ns(data$date, df=42)
model.ts0 <- glm(tm ~ spl, data=data, family=quasipoisson)
pred.ts0 <- predict(model.ts0, type="response")
# time-stratified case-crossover
data$month    <- as.factor(months(data$date))
data$year     <- as.factor(format(data$date, format="%Y") )
data$dow      <- as.factor(weekdays(data$date))
data$stratum2 <- as.factor(data$year:data$month)
model.cc0 <- glm(tm ~ stratum2, data=data, family=quasipoisson)
pred.cc0 <- predict(model.cc0, type="response")
# comparison
plot(data$date, data$tm, pch=19, cex=0.2, col=grey(0.6), ylab="Num. deaths", xlab="Date")
lines(data$date, pred.cc0, lwd=2, col="blue")
lines(data$date, pred.ts0, lwd=2, col="red")
# time-series
model.ts1 <- glm(tm ~ tsp + spl + dow + hol, data=data, family=quasipoisson)
cbind(model.ts1$coefficients[2], sqrt(summary(model.ts1)$cov.scaled[2,2]))
# case-crossover with Poisson regression fitting 3-way interaction
start1 <- Sys.time()
model.cco1 <- glm(tm ~ tsp + hol + factor(year)*factor(month)*factor(dow), data=data, family=quasipoisson)
end1 <- Sys.time()
summary(model.cco1)
data$stratum3 <- as.factor(data$year:data$month:data$dow)
start2 <- Sys.time()
model.cco2 <- glm(tm ~ tsp + hol + stratum3 , data=data, family=quasipoisson)
end2 <- Sys.time()
summary(model.cco2)
# case-crossover with conditional Poisson
start3 <- Sys.time()
model.cco3 <- gnm(tm ~ tsp + hol , data=data, family=quasipoisson, eliminate=factor(stratum3))
end3 <- Sys.time()
summary(model.cco3)
# comparison within case-crossover approaches
cbind(model.cco1$coefficients[2], sqrt(summary(model.cco1)$cov.scaled[2,2]), end1-start1)
cbind(model.cco2$coefficients[2], sqrt(summary(model.cco2)$cov.scaled[2,2]), end2-start2)
cbind(model.cco3$coefficients[1], sqrt(summary(model.cco3)$cov.scaled[1,1]), end3-start3)
# overall comparison between time-series vs case-crossover
# time-series
cbind((exp(model.ts1$coefficients[2]*10)-1)*100,
(exp((model.ts1$coefficients[2]-1.96*sqrt(summary(model.ts1)$cov.scaled[2,2]))*10)-1)*100,
(exp((model.ts1$coefficients[2]+1.96*sqrt(summary(model.ts1)$cov.scaled[2,2]))*10)-1)*100)
# case-crossover
cbind((exp(model.cco3$coefficients[1]*10)-1)*100,
(exp((model.cco3$coefficients[1]-1.96*sqrt(summary(model.cco3)$cov.scaled[1,1]))*10)-1)*100,
(exp((model.cco3$coefficients[1]+1.96*sqrt(summary(model.cco3)$cov.scaled[1,1]))*10)-1)*100)
# reshape dataset from wide to long format
data.long <- pivot_longer(data, tm0:tm1, names_to = "age", values_to = "tm_age") %>%
mutate(age=str_remove(age,"tm") %>% as.factor)
str(data.long)
# overall effect of tsp
(exp(model.cco3$coefficients[1]*10)-1)*100
# age as confounder
model.age1 <- gnm(tm_age ~ tsp + hol + age, data=data.long, family=quasipoisson, eliminate=factor(stratum3))
summary(model.age1)
(exp(model.age1$coefficients[1]*10)-1)*100
data.long$stratum4 <- as.factor(data.long$year:data.long$month:data.long$dow:data.long$age)
model.age2 <- gnm(tm_age ~ tsp + hol , data=data.long, family=quasipoisson, eliminate=factor(stratum4))
summary(model.age2)
(exp(model.age2$coefficients[1]*10)-1)*100
# age as effect modifier from model with interaction
model.age3 <- gnm(tm_age ~ tsp*age + hol, data=data.long, family=quasipoisson, eliminate=factor(stratum4))
summary(model.age3)
(exp(model.age3$coefficients[1]*10)-1)*100
(exp((model.age3$coefficients[1]+model.age3$coefficients[4])*10)-1)*100
# define heatwave based as the 95th centile of the mean temperature distribution
q95 <- quantile(x=data$tmean, probs=c(.95))
data$hw <- as.factor(ifelse(data$tmean > q95, 1, 0))
table(data$hw)
# overall effect of tsp
(exp(model.cco3$coefficients[1]*10)-1)*100
# heatwave as confounder
model.hw1 <- gnm(tm ~ tsp + hol + hw, data=data, family=quasipoisson, eliminate=factor(stratum3))
summary(model.hw1)
(exp(model.hw1$coefficients[1])-1)*100
data$stratum4 <- as.factor(data$year:data$month:data$dow:data$hw)
summary(model.hw2)
model.hw2 <- gnm(tm ~ tsp + hol, data=data, family=quasipoisson, eliminate=factor(stratum4))
summary(model.hw2)
(exp(model.hw2$coefficients[1])-1)*100
# heatwave as effect modifier from model with interaction
model.hw3 <- gnm(tm ~ tsp*hw + hol, data=data, family=quasipoisson, eliminate=factor(stratum4))
summary(model.hw3)
(exp(model.hw3$coefficients[1])-1)*100
# heatwave as effect modifier from specific-stratum models
# without heatwaves
data.ghw0 <- data[which(data$hw==0),]
model.ghw0 <- gnm(tm ~ tsp + hol , data=data.ghw0, family=quasipoisson, eliminate=factor(stratum3))
model.ghw0$coefficients[1]
# with heatwaves
data.ghw1 <- data[which(data$hw==1),]
model.ghw1 <- gnm(tm ~ tsp + hol , data=data.ghw1, family=quasipoisson, eliminate=factor(stratum3))
(exp(model.ghw1$coefficients[1])-1)*100
(exp(model.hw3$coefficients[1])-1)*100
(exp(model.hw3$coefficients[1]+model.hw3$coefficients[4])-1)*100
(exp(model.ghw0$coefficients[1])-1)*100
(exp(model.ghw1$coefficients[1])-1)*100
# heatwave as confounder
model.hw1 <- gnm(tm ~ tsp + hol + hw, data=data, family=quasipoisson, eliminate=factor(stratum3))
summary(model.hw1)
(exp(model.hw1$coefficients[1])-1)*100
data$stratum4 <- as.factor(data$year:data$month:data$dow:data$hw)
model.hw2 <- gnm(tm ~ tsp + hol, data=data, family=quasipoisson, eliminate=factor(stratum4))
summary(model.hw2)
(exp(model.hw2$coefficients[1])-1)*100
# age as effect modifier from specific-stratum models
# age <65 years
data.gage0 <- data[which(data$age==0),]
model.gage0 <- gnm(tm ~ tsp + hol , data=data.gage0, family=quasipoisson, eliminate=factor(stratum3))
(exp(model.age0$coefficients[1])-1)*100
# age >65 years
data.ghw1 <- data[which(data$age==1),]
model.ghw1 <- gnm(tm ~ tsp + hol , data=data.gage1, family=quasipoisson, eliminate=factor(stratum3))
(exp(model.age1$coefficients[1])-1)*100
data.gage0
data.gage0 <- data[which(data.long$age==0),]
model.gage0 <- gnm(tm ~ tsp + hol , data=data.gage0, family=quasipoisson, eliminate=factor(stratum3))
(exp(model.age0$coefficients[1])-1)*100
(exp(model.gage0$coefficients[1])-1)*100
(exp(model.age3$coefficients[1]*10)-1)*100
data.gage0 <- data[which(data.long$age==0),]
model.gage0 <- gnm(tm ~ tsp + hol , data=data.gage0, family=quasipoisson, eliminate=factor(stratum4))
(exp(model.gage0$coefficients[1])-1)*100
data.gage1 <- data[which(data.long$gage==1),]
model.gage1 <- gnm(tm ~ tsp + hol , data=data.gage1, family=quasipoisson, eliminate=factor(stratum3))
(exp(model.gage1$coefficients[1])-1)*100
data.gage1 <- data[which(data.long$gage==1),]
data.gage1 <- data[which(data.long$age==1),]
model.gage1 <- gnm(tm ~ tsp + hol , data=data.gage1, family=quasipoisson, eliminate=factor(stratum3))
(exp(model.gage1$coefficients[1])-1)*100
model.gage1 <- gnm(tm ~ tsp + hol , data=data.gage1, family=quasipoisson, eliminate=factor(stratum4))
(exp(model.gage1$coefficients[1])-1)*100
(exp((model.age3$coefficients[1]+model.age3$coefficients[4])*10)-1)*100
data.gage1 <- data[which(data.long$age==1),]
model.gage1 <- gnm(tm ~ tsp + hol , data=data.gage1, family=quasipoisson, eliminate=factor(stratum3))
(exp(model.gage1$coefficients[1])-1)*100
# age as effect modifier from specific-stratum models
# age <65 years
data.gage0 <- data[which(data.long$age==0),]
model.gage0 <- gnm(tm ~ tsp + hol , data=data.gage0, family=quasipoisson, eliminate=factor(stratum4))
(exp(model.gage0$coefficients[1]*10)-1)*100
# age >65 years
data.gage1 <- data[which(data.long$age==1),]
model.gage1 <- gnm(tm ~ tsp + hol , data=data.gage1, family=quasipoisson, eliminate=factor(stratum3))
(exp(model.gage1$coefficients[1]*10)-1)*100
(exp(model.age3$coefficients[1]*10)-1)*100
(exp((model.age3$coefficients[1]+model.age3$coefficients[4])*10)-1)*100
# age as effect modifier from specific-stratum models
# age <65 years
data.gage0 <- data[which(data.long$age==0),]
model.gage0 <- gnm(tm ~ tsp + hol , data=data.gage0, family=quasipoisson, eliminate=factor(stratum3))
(exp(model.gage0$coefficients[1]*10)-1)*100
# age >65 years
data.gage1 <- data[which(data.long$age==1),]
model.gage1 <- gnm(tm ~ tsp + hol , data=data.gage1, family=quasipoisson, eliminate=factor(stratum3))
(exp(model.gage1$coefficients[1]*10)-1)*100
(exp((model.age3$coefficients[1]+model.age3$coefficients[4])*10)-1)*100
# Load libraries
library(foreign)
library(tidyverse)
library(splines)
library(gnm)
data <- read.dta("misdatos_valencia.dta")
str(data)
data$tm <- data$tm0 + data$tm1
# time-series analysis
spl <- ns(data$date, df=42)
model.ts0 <- glm(tm ~ spl, data=data, family=quasipoisson)
pred.ts0 <- predict(model.ts0, type="response")
data$month    <- as.factor(months(data$date))
data$year     <- as.factor(format(data$date, format="%Y") )
data$dow      <- as.factor(weekdays(data$date))
data$stratum2 <- as.factor(data$year:data$month)
data$stratum2
model.cc0 <- glm(tm ~ stratum2, data=data, family=quasipoisson)
pred.cc0 <- predict(model.cc0, type="response")
# comparison
plot(data$date, data$tm, pch=19, cex=0.2, col=grey(0.6), ylab="Num. deaths", xlab="Date")
lines(data$date, pred.cc0, lwd=2, col="blue")
lines(data$date, pred.ts0, lwd=2, col="red")
model.ts1 <- glm(tm ~ tsp + spl + dow + hol, data=data, family=quasipoisson)
cbind(model.ts1$coefficients[2], sqrt(summary(model.ts1)$cov.scaled[2,2]))
# case-crossover with Poisson regression fitting 3-way interaction
start1 <- Sys.time()
model.cco1 <- glm(tm ~ tsp + hol + factor(year)*factor(month)*factor(dow), data=data, family=quasipoisson)
end1 <- Sys.time()
summary(model.cco1)
data$stratum3 <- as.factor(data$year:data$month:data$dow)
start2 <- Sys.time()
model.cco2 <- glm(tm ~ tsp + hol + stratum3 , data=data, family=quasipoisson)
end2 <- Sys.time()
summary(model.cco2)
# case-crossover with conditional Poisson
start3 <- Sys.time()
model.cco3 <- gnm(tm ~ tsp + hol , data=data, family=quasipoisson, eliminate=factor(stratum3))
end3 <- Sys.time()
summary(model.cco3)
cbind(model.ts1$coefficients[2], sqrt(summary(model.ts1)$cov.scaled[2,2]))
cbind(model.cco1$coefficients[2], sqrt(summary(model.cco1)$cov.scaled[2,2]), end1-start1)
cbind(model.cco2$coefficients[2], sqrt(summary(model.cco2)$cov.scaled[2,2]), end2-start2)
cbind(model.cco3$coefficients[1], sqrt(summary(model.cco3)$cov.scaled[1,1]), end3-start3)
# reshape dataset from wide to long format
data.long <- pivot_longer(data, tm0:tm1, names_to = "age", values_to = "tm_age") %>%
mutate(age=str_remove(age,"tm") %>% as.factor)
str(data.long)
str(data)
str(data.long)
# overall effect of tsp
(exp(model.cco3$coefficients[1]*10)-1)*100
model.cco3$coefficients[1]
exp(model.cco3$coefficients[1]*10)
(exp(model.cco3$coefficients[1]*10)-1)*100
# age as confounder
model.age1 <- gnm(tm_age ~ tsp + hol + age, data=data.long, family=quasipoisson, eliminate=factor(stratum3))
summary(model.age1)
(exp(model.age1$coefficients[1]*10)-1)*100
data.long$stratum4 <- as.factor(data.long$year:data.long$month:data.long$dow:data.long$age)
model.age2 <- gnm(tm_age ~ tsp + hol , data=data.long, family=quasipoisson, eliminate=factor(stratum4))
summary(model.age2)
(exp(model.age2$coefficients[1]*10)-1)*100
# age as effect modifier from model with interaction
model.age3 <- gnm(tm_age ~ tsp*age + hol, data=data.long, family=quasipoisson, eliminate=factor(stratum4))
summary(model.age3)
(exp(model.age3$coefficients[1]*10)-1)*100
(exp((model.age3$coefficients[1]+model.age3$coefficients[4])*10)-1)*100
# age as effect modifier from specific-stratum models
# age <65 years
data.gage0 <- data[which(data.long$age==0),]
model.gage0 <- gnm(tm ~ tsp + hol , data=data.gage0, family=quasipoisson, eliminate=factor(stratum3))
(exp(model.gage0$coefficients[1]*10)-1)*100
# age >65 years
data.gage1 <- data[which(data.long$age==1),]
model.gage1 <- gnm(tm ~ tsp + hol , data=data.gage1, family=quasipoisson, eliminate=factor(stratum3))
(exp(model.gage1$coefficients[1]*10)-1)*100
